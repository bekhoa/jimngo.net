function search(){getClientInputs(),$.ajax({url:`https://h.api.crmls.org/RESO/OData/Property?$filter=(StandardStatus eq 'A')and(PropertyType eq '${property_type}')and(PropertySubType eq '${property_sub_type}')and(City eq '${city}')and(BathroomsTotalInteger ge ${bath})and(BedroomsTotal ge ${bed})and(ListPrice ge ${min_price})and(ListPrice le ${max_price})&$select=${select}&$orderby=${orderby}&$expand=${expand}`,method:"GET",headers:{Accept:"application/json",Authorization:"Bearer "+token}}).done(function(e){listings=e.value,updateCities(),$("#searchCity").html(`${city} Real Estate<br/>Homes For Sale`),$("#listingCount").html(`${listings.length} Listings`),$("#records").empty(),$("#listing-indexed-pages").empty(),renderlistingPages()})}function renderlistingPages(){var e=0,i=0,t=12;for(e=0;e<listings.length;e+=t){var n=listings.slice(e,e+t);listingPages.push(n);var s=`<button onclick="displayIndexedListingPage(${i})">${i+1}</button>`;$("#listing-indexed-pages").append(s),i++}displayListings(0)}function displayListings(e){$("#records").empty();for(var i=listingPages[e],t=0;t<i.length;t++){listing=i[t],updateListing(),ListingId=listing.ListingId;var n=listing.Media[0].MediaURL,s=(n=n.slice(0,4)+"s"+n.slice(4),`\n            <div class='col-4 col-s-6'>\n                <div class='border'>\n                    <img class="photo-card" src="${n}" id="${ListingId}" onclick="singleListing('${ListingId}')">\n                    <div class="inputTitleContainer">\n                        <div class="inputTitle font-large">$${listing.ListPrice}</div>\n                        <div class="inputValue">${listing.MajorChangeType}</div>\n                    </div>\n                    <div>&ensp;• Listing ID: ${listing.ListingId}</div>\n                    <div>&ensp;• ${listing.BedroomsTotal} Beds • ${listing.BathroomsTotalInteger} Baths • ${listing.LivingArea} sqft</div>\n                    <div>&ensp;${listing.StreetNumberNumeric} ${listing.StreetName} ${listing.StreetSuffix}, ${listing.City} CA ${listing.PostalCode}</div>\n                </div>\n            </div>\n        `);$("#records").append(s)}}function displayIndexedListingPage(e){displayListings(e),document.getElementById("searchCity").scrollIntoView()}function singleListing(e){clearTimeout(slideShow),$("#photo-slide").empty(),$("#remarks").empty(),document.getElementById("listing-indexed-pages").scrollIntoView();for(var i=listings.find(i=>i.ListingId===e),t=i.Media,n=0;n<t.length;n++){var s=t[n].MediaURL,a=(s=s.slice(0,4)+"s"+s.slice(4),`\n        <div class='mySlides fade'>\n            <img  src="${s}" class='photo-big'>  \n        </div>    \n        `);$("#photo-slide").append(a)}slides=document.getElementsByClassName("mySlides"),slideIndex=0,displayPhoto();var o=`\n    <div class="inputTitleContainer">\n        <div class="inputTitle font-large">$${i.ListPrice}</div>\n        <div class="inputValue">${i.MajorChangeType}</div>\n    </div>\n    <div>&ensp;• Listing ID: ${i.ListingId}</div>\n    <div>&ensp;• ${i.DaysOnMarket} Days On Market</div>\n    <div>&ensp;• ${i.BedroomsTotal} Beds • ${i.BathroomsTotalInteger} Baths • ${i.LivingArea} sqft</div>\n    <div>&ensp;${i.StreetNumberNumeric} ${i.StreetName} ${i.StreetSuffix}, ${i.City} CA ${i.PostalCode}</div>\n    <br/>\n    ${i.PublicRemarks}</div>\n    `;$("#remarks").append(o)}function displayPhoto(){for(var e=0;e<slides.length;e++)slides[e].style.display="none";slideIndex++,slideIndex>slides.length&&(slideIndex=1),slides[slideIndex-1].style.display="block",slideShow=setTimeout(displayPhoto,3e3)}function updateCities(){"ONT"===city&&(city="Ontario CA"),"CH"===city&&(city="Chino CA"),"CHH"===city&&(city="Chino Hills CA"),"COR"===city&&(city="Corona"),"EVAL"===city&&(city="Eastvale"),"RVSD"===city&&(city="Riverside")}function updateListing(){"A"===listing.StandardStatus&&(listing.StandardStatus="Active"),"Resi"===listing.PropertyType&&(listing.PropertyType="Residential"),"SFR"===listing.PropertySubType&&(listing.PropertySubType="Single Family"),"TWNHS"===listing.PropertySubType&&(listing.PropertySubType="Townhouse"),"CONDO"===listing.PropertySubType&&(listing.PropertySubType="Condominium"),"ONT"===listing.City&&(listing.City="Ontario"),"CH"===listing.City&&(listing.City="Chino"),"CHH"===listing.City&&(listing.City="Chino Hills"),"COR"===listing.City&&(listing.City="Corona"),"EVAL"===listing.City&&(listing.City="Eastvale"),"RVSD"===listing.City&&(listing.City="Riverside"),"PRICECHG"===listing.MajorChangeType&&(listing.MajorChangeType="Price Change"),"NEWLIST"===listing.MajorChangeType&&(listing.MajorChangeType="New Listing"),"BOM"===listing.MajorChangeType&&(listing.MajorChangeType="Back On Market")}function sort_by_key(e,i){return e.sort(function(e,t){var n=e[i],s=t[i];return n<s?-1:n>s?1:0})}function getClientInputs(){getPropertyType(),getPropertySubType(),getCity(),getMinPrice(),getMaxPrice(),getBed(),getBath()}function getPropertyType(){property_type=document.getElementById("property_type").value}function getPropertySubType(){property_sub_type=document.getElementById("property_sub_type").value}function getCity(){city=document.getElementById("city").value}function getMinPrice(){min_price=document.getElementById("min_price").value}function getMaxPrice(){max_price=document.getElementById("max_price").value}function getBed(){bed=document.getElementById("bed").value}function getBath(){bath=document.getElementById("bath").value}function getShortName(e,i){var t=i.find(i=>i.longName===e);console.log(t);var n=t.shortName;console.log(" Abbreviation is "+n)}function getLongtName(e,i){var t=i.find(i=>i.shortName===e);console.log(t);var n=t.longName;console.log(" Abbreviation is "+n)}const connect={url:"https://op.api.crmls.org/identity/connect/token",method:"POST",timeout:0,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{client_id:"JIMNGO",client_secret:"2@jCM@z2",scope:"ODataApi",grant_type:"client_credentials"}},select="PropertyType, PropertySubType, StandardStatus, ListingId, ListPrice, OriginalListPrice, PublicRemarks, DaysOnMarket, StreetNumberNumeric, StreetName, StreetSuffix, City, PostalCode, BedroomsTotal, BathroomsTotalInteger, LivingArea, Cooling, Heating, AssociationFee, YearBuilt, DaysOnMarket, MajorChangeType, PhotosCount",orderby="ListPrice",expand="Media($select=MediaURL)";var listingId,slideShow,listings=[],listingPages=[],listing=[],picturesForListing=[];$.ajax(connect).done(function(e){token=e.access_token,search()});const names=[{shortName:"ONT",longName:"Ontario"},{shortName:"CH",longName:"Chino"},{shortName:"CHH",longName:"Chino Hills"},{shortName:"COR",longName:"Corona"},{shortName:"RVSD",longName:"Riverside"},{shortName:"EVAL",longName:"Eastvale"},{shortName:"Resi",longName:"Residential"}];