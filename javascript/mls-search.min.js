const connect={url:"https://soc.crmls.org/connect/token ",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{client_id:"JIMNGO",client_secret:"2@jCM@z2",scope:"ODataApi",grant_type:"client_credentials"},error:function(e){console.log(e)}},select="PropertyType,PropertySubType,StandardStatus,ListingId,ListPrice,OriginalListPrice,PublicRemarks,DaysOnMarket,StreetNumberNumeric,StreetName,StreetSuffix,City,PostalCode,BedroomsTotal,BathroomsTotalInteger,LivingArea,Cooling,Heating,AssociationFee,YearBuilt,DaysOnMarket,MajorChangeType,SpecialListingConditions,PhotosCount",orderby="ListPrice",expand="Media($select=MediaURL)";var listings=[],listingPages=[],listing=[],photoURLs=[],slides=[],shortSales=[],slideShow,token,property_type,property_sub_type,city,bath,bed,min_price,max_price,listingID,slideIndex;function search(){getClientInputs();var searchQuery={url:`https://h.api.crmls.org/RESO/OData/Property?$filter=(StandardStatus eq 'A')and(PropertyType eq '${property_type}')and(PropertySubType eq '${property_sub_type}')and(City eq '${city}')and(BathroomsTotalInteger ge ${bath})and(BedroomsTotal ge ${bed})and(ListPrice ge ${min_price})and(ListPrice le ${max_price})&$select=${select}&$orderby=ListPrice&$expand=${expand}`,method:"GET",headers:{Accept:"application/json",Authorization:"Bearer "+token},error:function(e){console.log(e)}};$.ajax(searchQuery).done((function(response){listings=response.value,updateCity(),$("#searchCity").html(`${city} Real Estate`),$("#listingCount").html(`${listings.length} Listings`),renderlistingPages(listings,12)}))}function renderlistingPages(array,chunk){listingPages=[],$("#listing-indexed-pages").empty();var i=0,j=0;for(i=0;i<array.length;i+=chunk){var myChunk=array.slice(i,i+chunk);listingPages.push(myChunk);var pageIndex=`<button onclick="displayIndexedListingPage(${j})">${j+1}</button>`;$("#listing-indexed-pages").append(pageIndex),j++}displayListings(0)}function displayListings(j){$("#records").empty(),listingPage=listingPages[j];for(var i=0;i<listingPage.length;i++){listing=listingPage[i],updateListing(),listingID=listing.ListingId;var firstPictureForListingURL,firstPictureForListingURL,html=`\n            <div class='col-4 col-s-6'>\n                <div class='border'>\n                    <img class="photo-card" src="${firstPictureForListingURL=(firstPictureForListingURL=listing.Media[0].MediaURL).slice(0,4)+"s"+firstPictureForListingURL.slice(4)}" id="${listingID}" onclick="singleListing('${listingID}')">\n                    <div class="inputTitleContainer">\n                        <div class="inputTitle font-large">$${listing.ListPrice}</div>\n                        <div class="inputValue">${listing.MajorChangeType}</div>\n                    </div>\n                    <div>&ensp;• Listing ID: ${listingID}</div>\n                    <div>&ensp;• ${listing.BedroomsTotal} Beds • ${listing.BathroomsTotalInteger} Baths • ${listing.LivingArea} sqft</div>\n                    <div>&ensp;${listing.StreetNumberNumeric} ${listing.StreetName} ${listing.StreetSuffix}, ${listing.City} CA ${listing.PostalCode}</div>\n                </div>\n            </div>\n        `;$("#records").append(html)}}function displayIndexedListingPage(j){displayListings(j),document.getElementById("searchCity").scrollIntoView()}function singleListing(listingID){clearTimeout(slideShow),$("#photo-slide").empty(),$("#remarks").empty(),photoURLs=[],document.getElementById("listing-indexed-pages").scrollIntoView();for(var listingMedia=(listing=listings.find(listing=>listing.ListingId===listingID)).Media,i=0;i<listingMedia.length;i++){var photoURL,photoURL=(photoURL=listingMedia[i].MediaURL).slice(0,4)+"s"+photoURL.slice(4);photoURLs.push(photoURL);var img=`\n        <div class='mySlides fade'>\n            <img  src="${photoURLs[i]}" class='photo-big'>  \n        </div>    \n        `;$("#photo-slide").append(img)}slides=document.getElementsByClassName("mySlides"),slideIndex=0,displayPhoto();var html=`\n    <div class="inputTitleContainer">\n        <div class="inputTitle font-large">$${listing.ListPrice}</div>\n        <div class="inputValue">${listing.MajorChangeType}</div>\n    </div>\n    <p>\n        <div>&ensp;• Listing ID: ${listing.ListingId}</div>\n        <div>&ensp;• ${listing.SpecialListingConditions}</div>\n        <div>&ensp;• ${listing.DaysOnMarket} Days On Market</div>\n        <div>&ensp;• ${listing.BedroomsTotal} Beds • ${listing.BathroomsTotalInteger} Baths • ${listing.LivingArea} sqft</div>\n        <div>&ensp;${listing.StreetNumberNumeric} ${listing.StreetName} ${listing.StreetSuffix}, ${listing.City} CA ${listing.PostalCode}</div>\n    </p>\n    <p>${listing.PublicRemarks}</p>\n    `;$("#remarks").append(html)}function displayPhoto(){for(var i=0;i<slides.length;i++)slides[i].style.display="none";++slideIndex>slides.length&&(slideIndex=1),slides[slideIndex-1].style.display="block",slideShow=setTimeout(displayPhoto,3e3)}function updateCity(){"ALTL"===city&&(city="Alta Loma"),"CH"===city&&(city="Chino"),"CHH"===city&&(city="Chino Hills"),"CLAR"===city&&(city="Claremont"),"COR"===city&&(city="Corona"),"EVAL"===city&&(city="Eastvale"),"FONT"===city&&(city="Fontana"),"HLND"===city&&(city="Highland"),"MCLR"===city&&(city="Montclair"),"ONT"===city&&(city="Ontario"),"POM"===city&&(city="Pomona"),"RCUC"===city&&(city="Rancho Cucamonga"),"RLT"===city&&(city="Rialto"),"RVSD"===city&&(city="Riverside"),"SB"===city&&(city="San Bernadino"),"UPL"===city&&(city="Upland")}function updateListing(){"ALTL"===listing.City&&(listing.City="Alta Loma"),"CH"===listing.City&&(listing.City="Chino"),"CHH"===listing.City&&(listing.City="Chino Hills"),"CLAR"===listing.City&&(listing.City="Claremont"),"COR"===listing.City&&(listing.City="Corona"),"EVAL"===listing.City&&(listing.City="Eastvale"),"FONT"===listing.City&&(listing.City="Fontana"),"HLND"===listing.City&&(listing.City="Highland"),"MCLR"===listing.City&&(listing.City="Montclair"),"ONT"===listing.City&&(listing.City="Ontario"),"POM"===listing.City&&(listing.City="Pomona"),"RCUC"===listing.City&&(listing.City="Rancho Cucamonga"),"RLT"===listing.City&&(listing.City="Rialto"),"RVSD"===listing.City&&(listing.City="Riverside"),"SB"===listing.City&&(listing.City="San Bernardino"),"UPL"===listing.City&&(listing.City="Upland"),"PRICECHG"===listing.MajorChangeType&&(listing.MajorChangeType="Price Change"),"NEWLIST"===listing.MajorChangeType&&(listing.MajorChangeType="New Listing"),"BOM"===listing.MajorChangeType&&(listing.MajorChangeType="Back On Market"),"Resi"===listing.PropertyType&&(listing.PropertyType="Residential"),"SFR"===listing.PropertySubType&&(listing.PropertySubType="Single Family"),"TWNHS"===listing.PropertySubType&&(listing.PropertySubType="Townhouse"),"CONDO"===listing.PropertySubType&&(listing.PropertySubType="Condominium"),"A"===listing.StandardStatus&&(listing.StandardStatus="Active"),"SPAY"===listing.SpecialListingConditions&&(listing.SpecialListingConditions="Short Sale"),"STD"===listing.SpecialListingConditions&&(listing.SpecialListingConditions="Standard"),"NOD"===listing.SpecialListingConditions&&(listing.SpecialListingConditions="Notice of Default")}function shortSale(){shortSales=listings.filter(listing=>"Short Sale"===listing.SpecialListingConditions),listingPages=[],renderlistingPages(shortSales,12)}function sort_by_key(array,key){return array.sort((function(a,b){var x=a[key],y=b[key];return x<y?-1:x>y?1:0}))}function getClientInputs(){getPropertyType(),getPropertySubType(),getCity(),getMinPrice(),getMaxPrice(),getBed(),getBath()}function getPropertyType(){property_type=document.getElementById("property_type").value}function getPropertySubType(){property_sub_type=document.getElementById("property_sub_type").value}function getCity(){city=document.getElementById("city").value}function getMinPrice(){min_price=document.getElementById("min_price").value}function getMaxPrice(){max_price=document.getElementById("max_price").value}function getBed(){bed=document.getElementById("bed").value}function getBath(){bath=document.getElementById("bath").value}$.ajax(connect).done((function(response){token=response.access_token,search()}));