function search(){getClientInputs();var i={url:`https://h.api.crmls.org/RESO/OData/Property?$filter=(StandardStatus eq 'A')and(PropertyType eq '${property_type}')and(PropertySubType eq '${property_sub_type}')and(City eq '${city}')and(BathroomsTotalInteger ge ${bath})and(BedroomsTotal ge ${bed})and(ListPrice ge ${min_price})and(ListPrice le ${max_price})&$select=${select}&$orderby=${orderby}&$expand=${expand}`,method:"GET",headers:{Accept:"application/json",Authorization:"Bearer "+token},error:function(i){console.log(i)}};$.ajax(i).done(function(i){listings=i.value,updateCity(),$("#searchCity").html(`${city} Real Estate`),$("#listingCount").html(`${listings.length} Listings`),renderlistingPages(listings,12)})}function renderlistingPages(i,t){listingPages=[],$("#listing-indexed-pages").empty();var e=0,n=0;for(e=0;e<i.length;e+=t){var s=i.slice(e,e+t);listingPages.push(s);var l=`<button onclick="displayIndexedListingPage(${n})">${n+1}</button>`;$("#listing-indexed-pages").append(l),n++}displayListings(0)}function displayListings(i){$("#records").empty(),listingPage=listingPages[i];for(var t=0;t<listingPage.length;t++){listing=listingPage[t],updateListing(),listingID=listing.ListingId;var e=listing.Media[0].MediaURL,n=(e=e.slice(0,4)+"s"+e.slice(4),`\n            <div class='col-4 col-s-6'>\n                <div class='border'>\n                    <img class="photo-card" src="${e}" id="${listingID}" onclick="singleListing('${listingID}')">\n                    <div class="inputTitleContainer">\n                        <div class="inputTitle font-large">$${listing.ListPrice}</div>\n                        <div class="inputValue">${listing.MajorChangeType}</div>\n                    </div>\n                    <div>&ensp;• Listing ID: ${listingID}</div>\n                    <div>&ensp;• ${listing.BedroomsTotal} Beds • ${listing.BathroomsTotalInteger} Baths • ${listing.LivingArea} sqft</div>\n                    <div>&ensp;${listing.StreetNumberNumeric} ${listing.StreetName} ${listing.StreetSuffix}, ${listing.City} CA ${listing.PostalCode}</div>\n                </div>\n            </div>\n        `);$("#records").append(n)}}function displayIndexedListingPage(i){displayListings(i),document.getElementById("searchCity").scrollIntoView()}function singleListing(i){clearTimeout(slideShow),$("#photo-slide").empty(),$("#remarks").empty(),photoURLs=[],document.getElementById("listing-indexed-pages").scrollIntoView(),listing=listings.find(t=>t.ListingId===i);for(var t=listing.Media,e=0;e<t.length;e++){var n=t[e].MediaURL;n=n.slice(0,4)+"s"+n.slice(4);photoURLs.push(n);var s=`\n        <div class='mySlides fade'>\n            <img  src="${photoURLs[e]}" class='photo-big'>  \n        </div>    \n        `;$("#photo-slide").append(s)}slides=document.getElementsByClassName("mySlides"),slideIndex=0,displayPhoto();var l=`\n    <div class="inputTitleContainer">\n        <div class="inputTitle font-large">$${listing.ListPrice}</div>\n        <div class="inputValue">${listing.MajorChangeType}</div>\n    </div>\n    \n    <p>\n        <div>&ensp;• Listing ID: ${listing.ListingId}</div>\n        <div>&ensp;• ${listing.SpecialListingConditions}</div>\n        <div>&ensp;• ${listing.DaysOnMarket} Days On Market</div>\n        <div>&ensp;• ${listing.BedroomsTotal} Beds • ${listing.BathroomsTotalInteger} Baths • ${listing.LivingArea} sqft</div>\n        <div>&ensp;${listing.StreetNumberNumeric} ${listing.StreetName} ${listing.StreetSuffix}, ${listing.City} CA ${listing.PostalCode}</div>\n    </p>\n    <p>${listing.PublicRemarks}</p>\n    `;$("#remarks").append(l)}function displayPhoto(){for(var i=0;i<slides.length;i++)slides[i].style.display="none";slideIndex++,slideIndex>slides.length&&(slideIndex=1),slides[slideIndex-1].style.display="block",slideShow=setTimeout(displayPhoto,3e3)}function updateCity(){"ALTL"===city&&(city="Alta Loma"),"CH"===city&&(city="Chino"),"CHH"===city&&(city="Chino Hills"),"CLAR"===city&&(city="Claremont"),"COR"===city&&(city="Corona"),"EVAL"===city&&(city="Eastvale"),"FONT"===city&&(city="Fontana"),"HLND"===city&&(city="Highland"),"MCLR"===city&&(city="Montclair"),"ONT"===city&&(city="Ontario"),"POM"===city&&(city="Pomona"),"RCUC"===city&&(city="Rancho Cucamonga"),"RLT"===city&&(city="Rialto"),"RVSD"===city&&(city="Riverside"),"SB"===city&&(city="San Bernadino"),"UPL"===city&&(city="Upland")}function updateListing(){"ALTL"===listing.City&&(listing.City="Alta Loma"),"CH"===listing.City&&(listing.City="Chino"),"CHH"===listing.City&&(listing.City="Chino Hills"),"CLAR"===listing.City&&(listing.City="Claremont"),"COR"===listing.City&&(listing.City="Corona"),"EVAL"===listing.City&&(listing.City="Eastvale"),"FONT"===listing.City&&(listing.City="Fontana"),"HLND"===listing.City&&(listing.City="Highland"),"MCLR"===listing.City&&(listing.City="Montclair"),"ONT"===listing.City&&(listing.City="Ontario"),"POM"===listing.City&&(listing.City="Pomona"),"RCUC"===listing.City&&(listing.City="Rancho Cucamonga"),"RLT"===listing.City&&(listing.City="Rialto"),"RVSD"===listing.City&&(listing.City="Riverside"),"SB"===listing.City&&(listing.City="San Bernardino"),"UPL"===listing.City&&(listing.City="Upland"),"PRICECHG"===listing.MajorChangeType&&(listing.MajorChangeType="Price Change"),"NEWLIST"===listing.MajorChangeType&&(listing.MajorChangeType="New Listing"),"BOM"===listing.MajorChangeType&&(listing.MajorChangeType="Back On Market"),"Resi"===listing.PropertyType&&(listing.PropertyType="Residential"),"SFR"===listing.PropertySubType&&(listing.PropertySubType="Single Family"),"TWNHS"===listing.PropertySubType&&(listing.PropertySubType="Townhouse"),"CONDO"===listing.PropertySubType&&(listing.PropertySubType="Condominium"),"A"===listing.StandardStatus&&(listing.StandardStatus="Active"),"SPAY"===listing.SpecialListingConditions&&(listing.SpecialListingConditions="Short Sale"),"STD"===listing.SpecialListingConditions&&(listing.SpecialListingConditions="Standard"),"NOD"===listing.SpecialListingConditions&&(listing.SpecialListingConditions="Notice of Default")}function shortSale(){shortSales=listings.filter(i=>"Short Sale"===i.SpecialListingConditions),listingPages=[],renderlistingPages(shortSales,12)}function sort_by_key(i,t){return i.sort(function(i,e){var n=i[t],s=e[t];return n<s?-1:n>s?1:0})}function getClientInputs(){getPropertyType(),getPropertySubType(),getCity(),getMinPrice(),getMaxPrice(),getBed(),getBath()}function getPropertyType(){property_type=document.getElementById("property_type").value}function getPropertySubType(){property_sub_type=document.getElementById("property_sub_type").value}function getCity(){city=document.getElementById("city").value}function getMinPrice(){min_price=document.getElementById("min_price").value}function getMaxPrice(){max_price=document.getElementById("max_price").value}function getBed(){bed=document.getElementById("bed").value}function getBath(){bath=document.getElementById("bath").value}const connect={url:"https://soc.crmls.org/connect/token ",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{client_id:"JIMNGO",client_secret:"2@jCM@z2",scope:"ODataApi",grant_type:"client_credentials"},error:function(i){console.log(i)}},select="PropertyType,PropertySubType,StandardStatus,ListingId,ListPrice,OriginalListPrice,PublicRemarks,DaysOnMarket,StreetNumberNumeric,StreetName,StreetSuffix,City,PostalCode,BedroomsTotal,BathroomsTotalInteger,LivingArea,Cooling,Heating,AssociationFee,YearBuilt,DaysOnMarket,MajorChangeType,SpecialListingConditions,PhotosCount",orderby="ListPrice",expand="Media($select=MediaURL)";var slideShow,token,property_type,property_sub_type,city,bath,bed,min_price,max_price,listingID,slideIndex,listings=[],listingPages=[],listing=[],photoURLs=[],slides=[],shortSales=[];$.ajax(connect).done(function(i){token=i.access_token,search()});